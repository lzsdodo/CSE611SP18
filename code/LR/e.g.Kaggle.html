
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-monokai .ace_gutter {background: #2F3129;color: #8F908A}.ace-monokai .ace_print-margin {width: 1px;background: #555651}.ace-monokai {background-color: #272822;color: #F8F8F2}.ace-monokai .ace_cursor {color: #F8F8F0}.ace-monokai .ace_marker-layer .ace_selection {background: #49483E}.ace-monokai.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #272822;}.ace-monokai .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-monokai .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #49483E}.ace-monokai .ace_marker-layer .ace_active-line {background: #202020}.ace-monokai .ace_gutter-active-line {background-color: #272727}.ace-monokai .ace_marker-layer .ace_selected-word {border: 1px solid #49483E}.ace-monokai .ace_invisible {color: #52524d}.ace-monokai .ace_entity.ace_name.ace_tag,.ace-monokai .ace_keyword,.ace-monokai .ace_meta.ace_tag,.ace-monokai .ace_storage {color: #F92672}.ace-monokai .ace_punctuation,.ace-monokai .ace_punctuation.ace_tag {color: #fff}.ace-monokai .ace_constant.ace_character,.ace-monokai .ace_constant.ace_language,.ace-monokai .ace_constant.ace_numeric,.ace-monokai .ace_constant.ace_other {color: #AE81FF}.ace-monokai .ace_invalid {color: #F8F8F0;background-color: #F92672}.ace-monokai .ace_invalid.ace_deprecated {color: #F8F8F0;background-color: #AE81FF}.ace-monokai .ace_support.ace_constant,.ace-monokai .ace_support.ace_function {color: #66D9EF}.ace-monokai .ace_fold {background-color: #A6E22E;border-color: #F8F8F2}.ace-monokai .ace_storage.ace_type,.ace-monokai .ace_support.ace_class,.ace-monokai .ace_support.ace_type {font-style: italic;color: #66D9EF}.ace-monokai .ace_entity.ace_name.ace_function,.ace-monokai .ace_entity.ace_other,.ace-monokai .ace_entity.ace_other.ace_attribute-name,.ace-monokai .ace_variable {color: #A6E22E}.ace-monokai .ace_variable.ace_parameter {font-style: italic;color: #FD971F}.ace-monokai .ace_string {color: #E6DB74}.ace-monokai .ace_comment {color: #75715E}.ace-monokai .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWPQ0FD0ZXBzd/wPAAjVAoxeSgNeAAAAAElFTkSuQmCC) right repeat-y}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 14px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 14px;}.latex-cell {font-size: 14px;}</style>
    </head>
    <body>
      
      <div id="titlearea">
        <h2>e.g. Kaggle 自行车租赁预测比赛</h2>
      </div>
      <div id="contentarea"><div class="cell markdown-cell"><h1>Kaggle自行车租赁预测比赛</h1>
</div><div class="cell markdown-cell"><p>Kaggle 中最有名的例子是<a href="https://www.kaggle.com/c/titanic">泰坦尼克号之灾</a>的例子，因为数据量小，同时趣味性很浓。我之前写过一篇博客<a href="http://blog.csdn.net/han_xiaoyang/article/details/49797143">逻辑回归应用之 Kaggle 泰坦尼克之灾</a>，介绍了一下逻辑斯特回归在这样一个<strong>分类问题上的应用</strong>，以及，一个<strong>完整的机器学习是什么样的</strong>。</p>
</div><div class="cell markdown-cell"><p>这里的 <a href="https://www.kaggle.com/c/bike-sharing-demand">Kaggle 自行车租赁预测比赛</a>也同样是一个很有趣的问题，之所以要把它单拎出来，讲一讲，2 个原因和泰坦尼克号之灾是一样的，另外一个原因是，这是一个<strong>连续值预测的问题</strong>，本着各类问题我们都要覆盖一下的标准，咱们一起来看看这个问题。</p>
</div><div class="cell markdown-cell"><h2>数据读取与预分析</h2>
<blockquote>
<p>老朋友最靠谱，最好用，继续用 Python 中数据分析有着不可撼动统治地位的 Pandas 包<br>
Numpy 是科学计算包，也是肯定要用的。</p>
</blockquote>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">import</span> <span class="ace_identifier">numpy</span> <span class="ace_keyword">as</span> <span class="ace_identifier">np</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">import</span> <span class="ace_identifier">pandas</span> <span class="ace_keyword">as</span> <span class="ace_identifier">pd</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">import</span> <span class="ace_identifier">matplotlib</span>.<span class="ace_identifier">pyplot</span> <span class="ace_keyword">as</span> <span class="ace_identifier">plt</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">import</span> <span class="ace_identifier">seaborn</span> <span class="ace_keyword">as</span> <span class="ace_identifier">sns</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword ace_operator">%</span><span class="ace_identifier">matplotlib</span> <span class="ace_identifier">inline</span>
</div></div></div></div><div class="cell markdown-cell"><ul>
<li>读取与观察数据
<ul>
<li>顺畅的 excel 表格形式</li>
<li>了解一下<strong>字段的名字和类型</strong></li>
<li>了解一下任务有多艰巨(数据量有多大)
<ul>
<li>总结一下，总共有 10886 行，同时每一行有 12 列不同的信息</li>
</ul>
</li>
<li>脏数据问题，看看有没有缺省的字段</li>
</ul>
</li>
</ul>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">pd</span>.<span class="ace_identifier">read_csv</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'kaggle_bike_competition_train.csv'</span>, <span class="ace_identifier">header</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">)</span> <span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">观</span><span class="ace_cjk" style="width:NaNpx">察</span>...</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">dtypes</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">shape</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">count</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell markdown-cell"><ul>
<li>数据处理
<ul>
<li>第一个来处理时间，因为它包含的信息总是非常多的，变化都是随着时间发生的</li>
</ul>
</li>
</ul>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_support ace_function">type</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">datetime</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">把</span><span class="ace_cjk" style="width:NaNpx">月</span><span class="ace_cjk" style="width:NaNpx">、</span><span class="ace_cjk" style="width:NaNpx">日</span><span class="ace_cjk" style="width:NaNpx">、</span><span class="ace_cjk" style="width:NaNpx">和</span> <span class="ace_cjk" style="width:NaNpx">小</span><span class="ace_cjk" style="width:NaNpx">时</span><span class="ace_cjk" style="width:NaNpx">单</span><span class="ace_cjk" style="width:NaNpx">独</span><span class="ace_cjk" style="width:NaNpx">拎</span><span class="ace_cjk" style="width:NaNpx">出</span><span class="ace_cjk" style="width:NaNpx">来</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">放</span><span class="ace_cjk" style="width:NaNpx">到</span> 3 <span class="ace_cjk" style="width:NaNpx">列</span><span class="ace_cjk" style="width:NaNpx">中</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span><span class="ace_paren ace_lparen">[</span><span class="ace_string">'month'</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">pd</span>.<span class="ace_identifier">DatetimeIndex</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">datetime</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">month</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span><span class="ace_paren ace_lparen">[</span><span class="ace_string">'day'</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">pd</span>.<span class="ace_identifier">DatetimeIndex</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">datetime</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">dayofweek</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span><span class="ace_paren ace_lparen">[</span><span class="ace_string">'hour'</span><span class="ace_paren ace_rparen">]</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">pd</span>.<span class="ace_identifier">DatetimeIndex</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">datetime</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">hour</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">时</span><span class="ace_cjk" style="width:NaNpx">间</span><span class="ace_cjk" style="width:NaNpx">大</span><span class="ace_cjk" style="width:NaNpx">串</span><span class="ace_cjk" style="width:NaNpx">已</span><span class="ace_cjk" style="width:NaNpx">经</span><span class="ace_cjk" style="width:NaNpx">被</span><span class="ace_cjk" style="width:NaNpx">我</span><span class="ace_cjk" style="width:NaNpx">们</span><span class="ace_cjk" style="width:NaNpx">处</span><span class="ace_cjk" style="width:NaNpx">理</span><span class="ace_cjk" style="width:NaNpx">过</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">那</span><span class="ace_cjk" style="width:NaNpx">这</span><span class="ace_cjk" style="width:NaNpx">个</span><span class="ace_cjk" style="width:NaNpx">字</span><span class="ace_cjk" style="width:NaNpx">段</span><span class="ace_cjk" style="width:NaNpx">放</span><span class="ace_cjk" style="width:NaNpx">着</span><span class="ace_cjk" style="width:NaNpx">太</span><span class="ace_cjk" style="width:NaNpx">占</span><span class="ace_cjk" style="width:NaNpx">地</span><span class="ace_cjk" style="width:NaNpx">方</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">干</span><span class="ace_cjk" style="width:NaNpx">脆</span><span class="ace_cjk" style="width:NaNpx">就</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">要</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train</span> <span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">备</span><span class="ace_cjk" style="width:NaNpx">份</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train</span>.<span class="ace_identifier">drop</span><span class="ace_paren ace_lparen">([</span><span class="ace_string">'datetime'</span>, <span class="ace_string">'casual'</span>, <span class="ace_string">'registered'</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span> <span class="ace_comment"># drop</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">)</span> <span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">观</span><span class="ace_cjk" style="width:NaNpx">察</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train</span>.<span class="ace_identifier">shape</span>
</div></div></div></div><div class="cell markdown-cell"><ul>
<li>分割数据
<ul>
<li>分成 2 部分
<ol>
<li><code>df_train_target</code>：目标，也就是 count 字段。</li>
<li><code>df_train_data</code>：用于产出特征的数据。</li>
</ol>
</li>
</ul>
</li>
</ul>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_target</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train</span><span class="ace_paren ace_lparen">[</span><span class="ace_string">'count'</span><span class="ace_paren ace_rparen">]</span>.<span class="ace_identifier">values</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_data</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train</span>.<span class="ace_identifier">drop</span><span class="ace_paren ace_lparen">([</span><span class="ace_string">'count'</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">values</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'df_train_data shape is '</span>, <span class="ace_identifier">df_train_data</span>.<span class="ace_identifier">shape</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'df_train_target shape is '</span>, <span class="ace_identifier">df_train_target</span>.<span class="ace_identifier">shape</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell markdown-cell"><h2>机器学习算法</h2>
<blockquote>
<p>下面的过程会让你看到，其实应用机器学习算法的过程，多半是在调参，各种不同的参数会带来不同的结果（比如正则化系数，比如决策树类的算法的树深和棵树，比如距离判定准则等等等等）</p>
</blockquote>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sklearn</span> <span class="ace_keyword">import</span> <span class="ace_identifier">linear_model</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sklearn</span> <span class="ace_keyword">import</span> <span class="ace_identifier">cross_validation</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sklearn</span> <span class="ace_keyword">import</span> <span class="ace_identifier">svm</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sklearn</span>.<span class="ace_identifier">ensemble</span> <span class="ace_keyword">import</span> <span class="ace_identifier">RandomForestRegressor</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sklearn</span>.<span class="ace_identifier">learning_curve</span> <span class="ace_keyword">import</span> <span class="ace_identifier">learning_curve</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sklearn</span>.<span class="ace_identifier">grid_search</span> <span class="ace_keyword">import</span> <span class="ace_identifier">GridSearchCV</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">from</span> <span class="ace_identifier">sklearn</span>.<span class="ace_identifier">metrics</span> <span class="ace_keyword">import</span> <span class="ace_identifier">explained_variance_score</span>
</div></div></div></div><div class="cell markdown-cell"><ul>
<li>依旧会使用<strong>交叉验证</strong>的方式（交叉验证集约占全部数据的<strong>20%</strong>）来看看模型的效果，我们会试 <strong>支持向量回归/Suport Vector Regression</strong>, <strong>岭回归/Ridge Regression</strong> 和 <strong>随机森林回归/Random Forest Regressor</strong>。每个模型会跑 3 趟看平均的结果。</li>
</ul>
</div><div class="cell markdown-cell"><ul>
<li>Ref
<ul>
<li><a href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVR.html#sklearn.svm.SVR">支持向量回归</a></li>
<li><a href="http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html#sklearn.linear_model.Ridge">岭回归</a></li>
<li><a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">随机森林回归</a></li>
</ul>
</li>
</ul>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">总</span><span class="ace_cjk" style="width:NaNpx">得</span><span class="ace_cjk" style="width:NaNpx">切</span><span class="ace_cjk" style="width:NaNpx">分</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">下</span><span class="ace_cjk" style="width:NaNpx">数</span><span class="ace_cjk" style="width:NaNpx">据</span><span class="ace_cjk" style="width:NaNpx">咯</span><span class="ace_cjk" style="width:NaNpx">（</span><span class="ace_cjk" style="width:NaNpx">训</span><span class="ace_cjk" style="width:NaNpx">练</span><span class="ace_cjk" style="width:NaNpx">集</span><span class="ace_cjk" style="width:NaNpx">和</span><span class="ace_cjk" style="width:NaNpx">测</span><span class="ace_cjk" style="width:NaNpx">试</span><span class="ace_cjk" style="width:NaNpx">集</span><span class="ace_cjk" style="width:NaNpx">）</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">cv</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">cross_validation</span>.<span class="ace_identifier">ShuffleSplit</span><span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">len</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_rparen">)</span>, <span class="ace_identifier">n_iter</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">3</span>, <span class="ace_identifier">test_size</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0.2</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">random_state</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">各</span><span class="ace_cjk" style="width:NaNpx">种</span><span class="ace_cjk" style="width:NaNpx">模</span><span class="ace_cjk" style="width:NaNpx">型</span><span class="ace_cjk" style="width:NaNpx">来</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">圈</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'<span class="ace_cjk" style="width:NaNpx">岭</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span>'</span><span class="ace_paren ace_rparen">)</span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">for</span> <span class="ace_identifier">train</span>, <span class="ace_identifier">test</span> <span class="ace_keyword">in</span> <span class="ace_identifier">cv</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">svc</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">linear_model</span>.<span class="ace_identifier">Ridge</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">fit</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"train score: {0:.3f}, test score: {1:.3f}</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string">"</span>.<span class="ace_support ace_function">format</span><span class="ace_paren ace_lparen">(</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">])))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'<span class="ace_cjk" style="width:NaNpx">支</span><span class="ace_cjk" style="width:NaNpx">持</span><span class="ace_cjk" style="width:NaNpx">向</span><span class="ace_cjk" style="width:NaNpx">量</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span>/SVR(kernel='</span><span class="ace_identifier">rbf</span><span class="ace_string">', C=10,gamma=.001)'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">for</span> <span class="ace_identifier">train</span>, <span class="ace_identifier">test</span> <span class="ace_keyword">in</span> <span class="ace_identifier">cv</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">svc</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">svm</span>.<span class="ace_identifier">SVR</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kernel</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'rbf'</span>, <span class="ace_identifier">C</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">10</span>, <span class="ace_identifier">gamma</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">.001</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">fit</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"train score: {0:.3f}, test score: {1:.3f}</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string">"</span>.<span class="ace_support ace_function">format</span><span class="ace_paren ace_lparen">(</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">])))</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'<span class="ace_cjk" style="width:NaNpx">随</span><span class="ace_cjk" style="width:NaNpx">机</span><span class="ace_cjk" style="width:NaNpx">森</span><span class="ace_cjk" style="width:NaNpx">林</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span>/Random Forest(n_estimators = 100)'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">for</span> <span class="ace_identifier">train</span>, <span class="ace_identifier">test</span> <span class="ace_keyword">in</span> <span class="ace_identifier">cv</span>:    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">svc</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">RandomForestRegressor</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n_estimators</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">100</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">fit</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"train score: {0:.3f}, test score: {1:.3f}</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string">"</span>.<span class="ace_support ace_function">format</span><span class="ace_paren ace_lparen">(</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">])))</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">结</span><span class="ace_cjk" style="width:NaNpx">果</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_cjk" style="width:NaNpx">岭</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.339</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.332</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.330</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.370</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.342</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.320</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_cjk" style="width:NaNpx">支</span><span class="ace_cjk" style="width:NaNpx">持</span><span class="ace_cjk" style="width:NaNpx">向</span><span class="ace_cjk" style="width:NaNpx">量</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">SVR</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kernel</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'rbf'</span>,<span class="ace_identifier">C</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">10</span>,<span class="ace_identifier">gamma</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">.001</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.417</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.408</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.406</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.452</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.419</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.390</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_cjk" style="width:NaNpx">随</span><span class="ace_cjk" style="width:NaNpx">机</span><span class="ace_cjk" style="width:NaNpx">森</span><span class="ace_cjk" style="width:NaNpx">林</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span><span class="ace_keyword ace_operator">/</span><span class="ace_identifier">Random</span> <span class="ace_identifier">Forest</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n_estimators</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">100</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.982</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.865</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.981</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.880</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.981</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.870</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">随</span><span class="ace_cjk" style="width:NaNpx">机</span><span class="ace_cjk" style="width:NaNpx">森</span><span class="ace_cjk" style="width:NaNpx">林</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span><span class="ace_cjk" style="width:NaNpx">获</span><span class="ace_cjk" style="width:NaNpx">得</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">最</span><span class="ace_cjk" style="width:NaNpx">佳</span><span class="ace_cjk" style="width:NaNpx">结</span><span class="ace_cjk" style="width:NaNpx">果</span><span class="ace_cjk" style="width:NaNpx">。</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">有</span><span class="ace_cjk" style="width:NaNpx">没</span><span class="ace_cjk" style="width:NaNpx">有</span><span class="ace_cjk" style="width:NaNpx">想</span><span class="ace_cjk" style="width:NaNpx">过</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">也</span><span class="ace_cjk" style="width:NaNpx">有</span><span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">能</span><span class="ace_cjk" style="width:NaNpx">是</span><span class="ace_cjk" style="width:NaNpx">参</span><span class="ace_cjk" style="width:NaNpx">数</span><span class="ace_cjk" style="width:NaNpx">设</span><span class="ace_cjk" style="width:NaNpx">置</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">不</span><span class="ace_cjk" style="width:NaNpx">对</span><span class="ace_cjk" style="width:NaNpx">？</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">有</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">个</span><span class="ace_cjk" style="width:NaNpx">工</span><span class="ace_cjk" style="width:NaNpx">具</span><span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">以</span><span class="ace_cjk" style="width:NaNpx">帮</span><span class="ace_cjk" style="width:NaNpx">忙</span><span class="ace_cjk" style="width:NaNpx">我</span><span class="ace_cjk" style="width:NaNpx">们</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">叫</span><span class="ace_cjk" style="width:NaNpx">做</span> GridSearch<span class="ace_cjk" style="width:NaNpx">，</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">可</span><span class="ace_cjk" style="width:NaNpx">以</span><span class="ace_cjk" style="width:NaNpx">在</span><span class="ace_cjk" style="width:NaNpx">你</span><span class="ace_cjk" style="width:NaNpx">喝</span><span class="ace_cjk" style="width:NaNpx">咖</span><span class="ace_cjk" style="width:NaNpx">啡</span><span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">时</span><span class="ace_cjk" style="width:NaNpx">候</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">帮</span><span class="ace_cjk" style="width:NaNpx">你</span><span class="ace_cjk" style="width:NaNpx">搬</span><span class="ace_cjk" style="width:NaNpx">搬</span><span class="ace_cjk" style="width:NaNpx">砖</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">找</span><span class="ace_cjk" style="width:NaNpx">找</span><span class="ace_cjk" style="width:NaNpx">参</span><span class="ace_cjk" style="width:NaNpx">数</span></span>
</div></div></div></div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">X</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train_data</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">y</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train_target</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">X_train</span>, <span class="ace_identifier">X_test</span>, <span class="ace_identifier">y_train</span>, <span class="ace_identifier">y_test</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">cross_validation</span>.<span class="ace_identifier">train_test_split</span><span class="ace_paren ace_lparen">(</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    <span class="ace_identifier">X</span>, <span class="ace_identifier">y</span>, <span class="ace_identifier">test_size</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0.2</span>, <span class="ace_identifier">random_state</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">tuned_parameters</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[{</span><span class="ace_string">'n_estimators'</span>:<span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">10</span>,<span class="ace_constant ace_numeric">100</span>,<span class="ace_constant ace_numeric">500</span><span class="ace_paren ace_rparen">]}]</span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>    
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">scores</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">[</span><span class="ace_string">'r2'</span><span class="ace_paren ace_rparen">]</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">for</span> <span class="ace_identifier">score</span> <span class="ace_keyword">in</span> <span class="ace_identifier">scores</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span> <span class="ace_identifier">score</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">clf</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">GridSearchCV</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">RandomForestRegressor</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">tuned_parameters</span>, <span class="ace_identifier">cv</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">5</span>, <span class="ace_identifier">scoring</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">score</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">clf</span>.<span class="ace_identifier">fit</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">X_train</span>, <span class="ace_identifier">y_train</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"<span class="ace_cjk" style="width:NaNpx">别</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">喝</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">咖</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">啡</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">最</span><span class="ace_cjk" style="width:NaNpx">佳</span><span class="ace_cjk" style="width:NaNpx">参</span><span class="ace_cjk" style="width:NaNpx">数</span><span class="ace_cjk" style="width:NaNpx">找</span><span class="ace_cjk" style="width:NaNpx">到</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">亲</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">！</span><span class="ace_cjk" style="width:NaNpx">：</span>"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_comment">#best_estimator_ returns the best estimator chosen by the search</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">clf</span>.<span class="ace_identifier">best_estimator_</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"<span class="ace_cjk" style="width:NaNpx">得</span><span class="ace_cjk" style="width:NaNpx">分</span><span class="ace_cjk" style="width:NaNpx">分</span><span class="ace_cjk" style="width:NaNpx">别</span><span class="ace_cjk" style="width:NaNpx">是</span>:"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_comment"># grid_scores_<span class="ace_cjk" style="width:NaNpx">的</span><span class="ace_cjk" style="width:NaNpx">返</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">值</span>:</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_comment">#    * a dict of parameter settings</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_comment">#    * the mean score over the cross-validation folds </span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_comment">#    * the list of scores for each fold</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">for</span> <span class="ace_identifier">params</span>, <span class="ace_identifier">mean_score</span>, <span class="ace_identifier">scores</span> <span class="ace_keyword">in</span> <span class="ace_identifier">clf</span>.<span class="ace_identifier">grid_scores_</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"%0.3f (+/-%0.03f) for %r"</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_keyword ace_operator">%</span> <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">mean_score</span>, <span class="ace_identifier">scores</span>.<span class="ace_identifier">std</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">/</span> <span class="ace_constant ace_numeric">2</span>, <span class="ace_identifier">params</span><span class="ace_paren ace_rparen">))</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">找</span><span class="ace_cjk" style="width:NaNpx">到</span><span class="ace_cjk" style="width:NaNpx">了</span><span class="ace_cjk" style="width:NaNpx">最</span><span class="ace_cjk" style="width:NaNpx">佳</span><span class="ace_cjk" style="width:NaNpx">参</span><span class="ace_cjk" style="width:NaNpx">数</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_constant ace_numeric">0.852</span> <span class="ace_paren ace_lparen">(</span><span class="ace_keyword ace_operator">+/-</span><span class="ace_constant ace_numeric">0.006</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword">for</span> <span class="ace_paren ace_lparen">{</span><span class="ace_string">'n_estimators'</span>: <span class="ace_constant ace_numeric">10</span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_constant ace_numeric">0.862</span> <span class="ace_paren ace_lparen">(</span><span class="ace_keyword ace_operator">+/-</span><span class="ace_constant ace_numeric">0.005</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword">for</span> <span class="ace_paren ace_lparen">{</span><span class="ace_string">'n_estimators'</span>: <span class="ace_constant ace_numeric">100</span><span class="ace_paren ace_rparen">}</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_constant ace_numeric">0.863</span> <span class="ace_paren ace_lparen">(</span><span class="ace_keyword ace_operator">+/-</span><span class="ace_constant ace_numeric">0.006</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword">for</span> <span class="ace_paren ace_lparen">{</span><span class="ace_string">'n_estimators'</span>: <span class="ace_constant ace_numeric">500</span><span class="ace_paren ace_rparen">}</span>
</div></div></div></div><div class="cell markdown-cell"><p>Grid Search 帮你挑参数还是蛮方便的，你也可以大胆放心地在刚才其他的模型上试一把。<br>
而且要看看模型状态是不是，过拟合 or 欠拟合。<br>
依旧是学习曲</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">def</span> <span class="ace_identifier">plot_learning_curve</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">estimator</span>, <span class="ace_identifier">title</span>, <span class="ace_identifier">X</span>, <span class="ace_identifier">y</span>, <span class="ace_identifier">ylim</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">None</span>, <span class="ace_identifier">cv</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">None</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">n_jobs</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span>, <span class="ace_identifier">train_sizes</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">np</span>.<span class="ace_identifier">linspace</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">.1</span>, <span class="ace_constant ace_numeric">1.0</span>, <span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">))</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">figure</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">title</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">title</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">if</span> <span class="ace_identifier">ylim</span> <span class="ace_keyword">is</span> <span class="ace_keyword">not</span> <span class="ace_constant ace_language">None</span>:
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">plt</span>.<span class="ace_identifier">ylim</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword ace_operator">*</span><span class="ace_identifier">ylim</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">xlabel</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"Training examples"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">ylabel</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"Score"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">train_sizes</span>, <span class="ace_identifier">train_scores</span>, <span class="ace_identifier">test_scores</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">learning_curve</span><span class="ace_paren ace_lparen">(</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span>  <span class="ace_identifier">estimator</span>, <span class="ace_identifier">X</span>, <span class="ace_identifier">y</span>, <span class="ace_identifier">cv</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">cv</span>, <span class="ace_identifier">n_jobs</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">n_jobs</span>, <span class="ace_identifier">train_sizes</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">train_sizes</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">train_scores_mean</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">np</span>.<span class="ace_identifier">mean</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">train_scores</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">train_scores_std</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">np</span>.<span class="ace_identifier">std</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">train_scores</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">test_scores_mean</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">np</span>.<span class="ace_identifier">mean</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">test_scores</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">test_scores_std</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">np</span>.<span class="ace_identifier">std</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">test_scores</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">grid</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">fill_between</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">train_sizes</span>, <span class="ace_identifier">train_scores_mean</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_identifier">train_scores_std</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">train_scores_mean</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">train_scores_std</span>, <span class="ace_identifier">alpha</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0.1</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"r"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">fill_between</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">train_sizes</span>, <span class="ace_identifier">test_scores_mean</span> <span class="ace_keyword ace_operator">-</span> <span class="ace_identifier">test_scores_std</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">test_scores_mean</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">test_scores_std</span>, <span class="ace_identifier">alpha</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0.1</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"g"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">train_sizes</span>, <span class="ace_identifier">train_scores_mean</span>, <span class="ace_string">'o-'</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"r"</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">label</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"Training score"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">train_sizes</span>, <span class="ace_identifier">test_scores_mean</span>, <span class="ace_string">'o-'</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"g"</span>,
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">label</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"Cross-validation score"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">plt</span>.<span class="ace_identifier">legend</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">loc</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"best"</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">return</span> <span class="ace_identifier">plt</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">title</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">"Learning Curves (Random Forest, n_estimators = 100)"</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">cv</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">cross_validation</span>.<span class="ace_identifier">ShuffleSplit</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span>.<span class="ace_identifier">shape</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">n_iter</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">10</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">test_size</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0.2</span>, <span class="ace_identifier">random_state</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">estimator</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">RandomForestRegressor</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n_estimators</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">100</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plot_learning_curve</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">estimator</span>, <span class="ace_identifier">title</span>, <span class="ace_identifier">X</span>, <span class="ace_identifier">y</span>, <span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0.0</span>, <span class="ace_constant ace_numeric">1.01</span><span class="ace_paren ace_rparen">)</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>    <span class="ace_identifier">cv</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">cv</span>, <span class="ace_identifier">n_jobs</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">4</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">show</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell markdown-cell"><p>看出来了吧，训练集和测试集直接间隔那么大，这。。。一定是过拟合了<br>
随机森林这种算法学习能力非常强啦，大家从最上面对比各个模型得分的时候也可以看到，训练集和测试集的得分也是差蛮多的，过拟合还蛮明显。所以，我能说什么呢，你用了核弹去消灭蝗虫，然后土壤也有点长不出植物了<br>
so, 过拟合咱们怎么办来着？你来回答下？忘了？那还不去翻翻ppt</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">尝</span><span class="ace_cjk" style="width:NaNpx">试</span><span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">下</span><span class="ace_cjk" style="width:NaNpx">缓</span><span class="ace_cjk" style="width:NaNpx">解</span><span class="ace_cjk" style="width:NaNpx">过</span><span class="ace_cjk" style="width:NaNpx">拟</span><span class="ace_cjk" style="width:NaNpx">合</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">当</span><span class="ace_cjk" style="width:NaNpx">然</span><span class="ace_cjk" style="width:NaNpx">，</span><span class="ace_cjk" style="width:NaNpx">未</span><span class="ace_cjk" style="width:NaNpx">必</span><span class="ace_cjk" style="width:NaNpx">成</span><span class="ace_cjk" style="width:NaNpx">功</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">print</span> <span class="ace_string">"<span class="ace_cjk" style="width:NaNpx">随</span><span class="ace_cjk" style="width:NaNpx">机</span><span class="ace_cjk" style="width:NaNpx">森</span><span class="ace_cjk" style="width:NaNpx">林</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span>/Random Forest(n_estimators=200, max_features=0.6, max_depth=15)"</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_keyword">for</span> <span class="ace_identifier">train</span>, <span class="ace_identifier">test</span> <span class="ace_keyword">in</span> <span class="ace_identifier">cv</span>: 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_identifier">svc</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">RandomForestRegressor</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n_estimators</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">200</span>, <span class="ace_identifier">max_features</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">0.6</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">max_depth</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">15</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">fit</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span>   <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span>   <span class="ace_keyword">print</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"train score: {0:.3f}, test score: {1:.3f}</span><span class="ace_constant ace_language ace_escape">\n</span><span class="ace_string">"</span>.<span class="ace_support ace_function">format</span><span class="ace_paren ace_lparen">(</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">])</span>, 
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_indent-guide">    </span><span class="ace_indent-guide">    </span> <span class="ace_identifier">svc</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_data</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">df_train_target</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">test</span><span class="ace_paren ace_rparen">])))</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">随</span><span class="ace_cjk" style="width:NaNpx">机</span><span class="ace_cjk" style="width:NaNpx">森</span><span class="ace_cjk" style="width:NaNpx">林</span><span class="ace_cjk" style="width:NaNpx">回</span><span class="ace_cjk" style="width:NaNpx">归</span>/Random Forest(n_estimators=200, max_features=0.3)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.965</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.867</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.966</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.885</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.966</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.875</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.965</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.876</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.967</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.870</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.965</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.872</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.967</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.862</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.966</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.875</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.966</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.871</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">train</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.966</span>, <span class="ace_identifier">test</span> <span class="ace_identifier">score</span>: <span class="ace_constant ace_numeric">0.868</span>
</div></div></div></div><div class="cell markdown-cell"></div><div class="cell markdown-cell"><p>不知道大家有没有印象，我们之前说了，我们把“注册用户”和“未注册用户”加一块儿做的预测。<br>
另外一个思路是，咱们可以试着分开这两部分，分别预测一下，再求和。<br>
话说，特征和对应的“注册”和“未注册”用户都有了，这个部分就当做作业吧，大家试试。</p>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_registered</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">drop</span><span class="ace_paren ace_lparen">([</span><span class="ace_string">'datetime'</span>, <span class="ace_string">'casual'</span>, <span class="ace_string">'count'</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_casual</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">drop</span><span class="ace_paren ace_lparen">([</span><span class="ace_string">'datetime'</span>, <span class="ace_string">'count'</span>, <span class="ace_string">'registered'</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">axis</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_registered</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span> <span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">观</span><span class="ace_cjk" style="width:NaNpx">察</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_casual</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell markdown-cell"><ul>
<li>为啥这个例子中没有数据分析，那补充一下。</li>
<li>分析得到的结果，你们观察观察，看看有什么角度可以帮忙改善一下特征或者模型。</li>
</ul>
</div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">风</span><span class="ace_cjk" style="width:NaNpx">速</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">groupby</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'windspeed'</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">mean</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">marker</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'o'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">show</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">湿</span><span class="ace_cjk" style="width:NaNpx">度</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">groupby</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'humidity'</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">mean</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">marker</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'o'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">show</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">温</span><span class="ace_cjk" style="width:NaNpx">度</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">groupby</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">'temp'</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">mean</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">marker</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'o'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">show</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment">#<span class="ace_cjk" style="width:NaNpx">温</span><span class="ace_cjk" style="width:NaNpx">度</span><span class="ace_cjk" style="width:NaNpx">湿</span><span class="ace_cjk" style="width:NaNpx">度</span><span class="ace_cjk" style="width:NaNpx">变</span><span class="ace_cjk" style="width:NaNpx">化</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">x</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'temp'</span>, <span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'humidity'</span>, <span class="ace_identifier">kind</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'scatter'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">show</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># scatter<span class="ace_cjk" style="width:NaNpx">一</span><span class="ace_cjk" style="width:NaNpx">下</span><span class="ace_cjk" style="width:NaNpx">各</span><span class="ace_cjk" style="width:NaNpx">个</span><span class="ace_cjk" style="width:NaNpx">维</span><span class="ace_cjk" style="width:NaNpx">度</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">fig</span>, <span class="ace_identifier">axs</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">plt</span>.<span class="ace_identifier">subplots</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2</span>, <span class="ace_constant ace_numeric">3</span>, <span class="ace_identifier">sharey</span><span class="ace_keyword ace_operator">=</span><span class="ace_constant ace_language">True</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kind</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'scatter'</span>, <span class="ace_identifier">x</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'temp'</span>, <span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">ax</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">axs</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span>, <span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">figsize</span><span class="ace_keyword ace_operator">=</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">16</span>, <span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">)</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'magenta'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kind</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'scatter'</span>, <span class="ace_identifier">x</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'atemp'</span>, <span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">ax</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">axs</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span>, <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'cyan'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kind</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'scatter'</span>, <span class="ace_identifier">x</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'humidity'</span>, <span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">ax</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">axs</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span>, <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'red'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kind</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'scatter'</span>, <span class="ace_identifier">x</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'windspeed'</span>, <span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">ax</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">axs</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1</span>, <span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'yellow'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kind</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'scatter'</span>, <span class="ace_identifier">x</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'month'</span>, <span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">ax</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">axs</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1</span>, <span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'blue'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">df_train_origin</span>.<span class="ace_identifier">plot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">kind</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'scatter'</span>, <span class="ace_identifier">x</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'hour'</span>, <span class="ace_identifier">y</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'count'</span>, <span class="ace_identifier">ax</span><span class="ace_keyword ace_operator">=</span><span class="ace_identifier">axs</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">1</span>, <span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">]</span>, <span class="ace_identifier">color</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">'green'</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">sns</span>.<span class="ace_identifier">pairplot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">df_train_origin</span><span class="ace_paren ace_lparen">[[</span><span class="ace_string">"temp"</span>, <span class="ace_string">"month"</span>, <span class="ace_string">"humidity"</span>, <span class="ace_string">"count"</span><span class="ace_paren ace_rparen">]]</span>, <span class="ace_identifier">hue</span><span class="ace_keyword ace_operator">=</span><span class="ace_string">"count"</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div><div class="cell code-cell"><div class="ace-monokai"><div class="ace_static_highlight ace_show_gutter" style="counter-reset:ace_line 0"><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">看</span><span class="ace_cjk" style="width:NaNpx">看</span><span class="ace_cjk" style="width:NaNpx">相</span><span class="ace_cjk" style="width:NaNpx">关</span><span class="ace_cjk" style="width:NaNpx">度</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">corr</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">df_train_origin</span><span class="ace_paren ace_lparen">[[</span><span class="ace_string">'temp'</span>, <span class="ace_string">'weather'</span>, <span class="ace_string">'windspeed'</span>, <span class="ace_string">'day'</span>, <span class="ace_string">'month'</span>, <span class="ace_string">'hour'</span>, <span class="ace_string">'count'</span><span class="ace_paren ace_rparen">]]</span>.<span class="ace_identifier">corr</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">corr</span> <span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">观</span><span class="ace_cjk" style="width:NaNpx">察</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_comment"># <span class="ace_cjk" style="width:NaNpx">用</span><span class="ace_cjk" style="width:NaNpx">颜</span><span class="ace_cjk" style="width:NaNpx">色</span><span class="ace_cjk" style="width:NaNpx">深</span><span class="ace_cjk" style="width:NaNpx">浅</span><span class="ace_cjk" style="width:NaNpx">来</span><span class="ace_cjk" style="width:NaNpx">表</span><span class="ace_cjk" style="width:NaNpx">示</span><span class="ace_cjk" style="width:NaNpx">相</span><span class="ace_cjk" style="width:NaNpx">关</span><span class="ace_cjk" style="width:NaNpx">度</span></span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">figure</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">matshow</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">corr</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">colorbar</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div><div class="ace_line"><span class="ace_gutter ace_gutter-cell" unselectable="on"></span><span class="ace_identifier">plt</span>.<span class="ace_identifier">show</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>
</div></div></div></div></div>
      <script></script>
    </body>
    </html>
  